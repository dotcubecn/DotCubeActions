name: Quick Reference
on:
  schedule:
    - cron: '0 * * * *' # æ¯å°æ—¶00åˆ†æ‰§è¡Œ
  workflow_dispatch:    # æ‰‹åŠ¨è¿è¡Œ

env: # è®¾ç½®ç¯å¢ƒå˜é‡
  TZ: Asia/Shanghai # æ—¶åŒº

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸšœ æ‹‰å–æœ€æ–°ä»£ç 
        uses: actions/checkout@v3
        with:
          ref: 'main'
          repository: 'jaywcjlove/reference'
          # ä½¿ç”¨å®Œæ•´å…‹éš†ç¡®ä¿æ‰€æœ‰æ–‡ä»¶å­˜åœ¨
          fetch-depth: 0

      - name: ğŸ”§ è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v3
        with:
          node-version: '18'  # æ˜ç¡®æŒ‡å®šç‰ˆæœ¬
          # ç§»é™¤ç¼“å­˜é…ç½®é¿å…é”æ–‡ä»¶æ£€æŸ¥

      - name: â™»ï¸ ç¼–è¯‘é™æ€æ–‡ä»¶
        run: |
          # è·å–å½“å‰å¹´ä»½
          CURRENT_YEAR=$(date +%Y)
          # åˆ›å»º.envæ–‡ä»¶å¹¶å†™å…¥ç¯å¢ƒå˜é‡
          echo "REF_URL=${{ vars.REF_URL || 'http://dotcube.cc/' }}" > .env
          echo "REF_LABEL=${{ vars.REF_LABEL || 'ä¸»é¡µ' }}" >> .env
          echo "LICENSE=Â© $CURRENT_YEAR <a href=\"https://dotcube.cc/\">DotCube</a>" >> .env
          
          # ä½¿ç”¨æ ‡å‡†å®‰è£…æ–¹å¼ä»£æ›¿ci
          npm install
          npm run build

      - name: ğŸš€ WebDAV éƒ¨ç½²åˆ° storage.dotcube.cc
        uses: XPH0816/webdav-deploy-action@v0.3
        with:
          url: ${{ secrets.WEBDAV_URL }}
          username: ${{ secrets.WEBDAV_USERNAME }}
          password: ${{ secrets.WEBDAV_PASSWORD }}
          local: "./dist"
          remote: "/"
